#!/usr/bin/env coffee

require './prelude'
require './data'

for dir in [ "data/meta", "data/name", "data/tags" ]
  mkdir dir

files = process.argv[2..]

next = (o)->

suite_to_data files, (o)->
  {id, label, name} = o

  print "\r#{id}"

  mkdir "data/#{id}"
  write "data/#{id}/===", "#{label}\n"

  link "data/name/#{name}", "../#{id}"

  mkdir "data/meta/#{id}"
  link "data/meta/#{id}.label", label

  for tag in test_tags
    continue unless o[tag]?
    mkdir "data/tags/#{tag}"
    link "data/tags/#{tag}/#{id}", "../../#{id}"

  for name in test_data_names
    text = o[name]
    continue unless text?
    file = name.replace /^(.*)-(.*)$/, '$1.$2'
    if name.match /^(in-yaml|out-yaml|test-event|emit-yaml)$/
      text = text.replace /<SPC>/g, ' '
      text = text.replace /<TAB>/g, '\t'
    write "data/#{id}/#{file}", text

say '\rDone'

# vim: sw=2:
